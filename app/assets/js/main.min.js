!function(e,t){"use strict";function r(){function e(e,r){return t.extend(new(t.extend(function(){},{prototype:e})),r)}function r(e,t){var r=t.caseInsensitiveMatch,n={originalPath:e,regexp:e},o=n.keys=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(e,t,r,n){var a="?"===n?n:null,i="*"===n?n:null;return o.push({name:r,optional:!!a}),t=t||"",""+(a?"":t)+"(?:"+(a?t:"")+(i&&"(.+?)"||"([^/]+)")+(a||"")+")"+(a||"")}).replace(/([\/$\*])/g,"\\$1"),n.regexp=new RegExp("^"+e+"$",r?"i":""),n}var n={};this.when=function(e,o){if(n[e]=t.extend({reloadOnSearch:!0},o,e&&r(e,o)),e){var a="/"==e[e.length-1]?e.substr(0,e.length-1):e+"/";n[a]=t.extend({redirectTo:e},r(a,o))}return this},this.otherwise=function(e){return this.when(null,e),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function(r,o,a,i,s,l,c,u){function m(e,t){var r=t.keys,n={};if(!t.regexp)return null;var o=t.regexp.exec(e);if(!o)return null;for(var a=1,i=o.length;i>a;++a){var s=r[a-1],l="string"==typeof o[a]?decodeURIComponent(o[a]):o[a];s&&l&&(n[s.name]=l)}return n}function g(){var e=f(),n=v.current;e&&n&&e.$$route===n.$$route&&t.equals(e.pathParams,n.pathParams)&&!e.reloadOnSearch&&!h?(n.params=e.params,t.copy(n.params,a),r.$broadcast("$routeUpdate",n)):(e||n)&&(h=!1,r.$broadcast("$routeChangeStart",e,n),v.current=e,e&&e.redirectTo&&(t.isString(e.redirectTo)?o.path(p(e.redirectTo,e.params)).search(e.params).replace():o.url(e.redirectTo(e.pathParams,o.path(),o.search())).replace()),i.when(e).then(function(){if(e){var r,n,o=t.extend({},e.resolve);return t.forEach(o,function(e,r){o[r]=t.isString(e)?s.get(e):s.invoke(e)}),t.isDefined(r=e.template)?t.isFunction(r)&&(r=r(e.params)):t.isDefined(n=e.templateUrl)&&(t.isFunction(n)&&(n=n(e.params)),n=u.getTrustedResourceUrl(n),t.isDefined(n)&&(e.loadedTemplateUrl=n,r=l.get(n,{cache:c}).then(function(e){return e.data}))),t.isDefined(r)&&(o.$template=r),i.all(o)}}).then(function(o){e==v.current&&(e&&(e.locals=o,t.copy(e.params,a)),r.$broadcast("$routeChangeSuccess",e,n))},function(t){e==v.current&&r.$broadcast("$routeChangeError",e,n,t)}))}function f(){var r,a;return t.forEach(n,function(n){!a&&(r=m(o.path(),n))&&(a=e(n,{params:t.extend({},o.search(),r),pathParams:r}),a.$$route=n)}),a||n[null]&&e(n[null],{params:{},pathParams:{}})}function p(e,r){var n=[];return t.forEach((e||"").split(":"),function(e,t){if(0===t)n.push(e);else{var o=e.match(/(\w+)(.*)/),a=o[1];n.push(r[a]),n.push(o[2]||""),delete r[a]}}),n.join("")}var h=!1,v={routes:n,reload:function(){h=!0,r.$evalAsync(g)}};return r.$on("$locationChangeSuccess",g),v}]}function n(){this.$get=function(){return{}}}function o(e,r,n){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(o,a,i,s,l){function c(){f&&(f.remove(),f=null),m&&(m.$destroy(),m=null),g&&(n.leave(g,function(){f=null}),f=g,g=null)}function u(){var i=e.current&&e.current.locals,s=i&&i.$template;if(t.isDefined(s)){var u=o.$new(),f=e.current,v=l(u,function(e){n.enter(e,null,g||a,function(){!t.isDefined(p)||p&&!o.$eval(p)||r()}),c()});g=v,m=f.scope=u,m.$emit("$viewContentLoaded"),m.$eval(h)}else c()}var m,g,f,p=i.autoscroll,h=i.onload||"";o.$on("$routeChangeSuccess",u),u()}}}function a(e,t,r){return{restrict:"ECA",priority:-400,link:function(n,o){var a=r.current,i=a.locals;o.html(i.$template);var s=e(o.contents());if(a.controller){i.$scope=n;var l=t(a.controller,i);a.controllerAs&&(n[a.controllerAs]=l),o.data("$ngControllerController",l),o.children().data("$ngControllerController",l)}s(n)}}}var i=t.module("ngRoute",["ng"]).provider("$route",r);i.provider("$routeParams",n),i.directive("ngView",o),i.directive("ngView",a),o.$inject=["$route","$anchorScroll","$animate"],a.$inject=["$compile","$controller","$route"]}(window,window.angular);var MsUtils={};MsUtils.shuffle=function(e){for(var t,r,n=e.length;0!==n;)r=Math.floor(Math.random()*n),n-=1,t=e[n],e[n]=e[r],e[r]=t;return e},MsUtils.range=function(e,t){for(var r=[],n=e;t>=n;n++)r.push(n);return r},angular.module("app",["ngRoute"]),angular.module("app").config(["$routeProvider",function(e){e.when("/",{templateUrl:"templates/selCategory.html",controller:"CatCtrl"}).when("/selNames",{templateUrl:"templates/selNames.html",controller:"NameCtrl"}).when("/question",{templateUrl:"templates/question.html",controller:"QuestionCtrl"}).when("/answer",{templateUrl:"templates/answer.html",controller:"AnswerCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("app").controller("AnswerCtrl",["$scope","GameState","movieFactory",function(e,t){e.gameState=t.state();var r=function(){e.gameState.movie.title==e.gameState.guess&&(e.gameState.win=!0,e.gameState.points++)};r()}]),angular.module("app").controller("CatCtrl",["$scope","GameState","movieFactory",function(e,t,r){e.gameState=t.state(),e.questionReset=t.resetObj(),e.getMovie=function(){r.getMovie(e.gameState.category.id,e.gameState.year).then(function(t){e.gameState.movie=t,window.location="/#/selNames"},function(e){console.error("error getting movie: ",e)})},e.getYears=function(){if(0===e.gameState.years.length){for(var t=(new Date).getFullYear(),r=[],n=1990;t>=n;n++)r.push(n);var o=MsUtils.shuffle(r).slice(0,5);e.gameState.years=o.sort()}};var n=function(){console.log("begin new question");for(var t in e.questionReset)e.gameState.property=e.questionReset.property;r.getCategories().then(function(t){e.gameState.categories=t},function(e){console.error("error getting elements: ",e)})};n()}]),angular.module("app").controller("MovieGameCtrl",["$scope","GameState","movieFactory",function(e,t){e.gameState=t.state()}]),angular.module("app").controller("NameCtrl",["$scope","GameState","movieFactory",function(e,t,r){e.gameState=t.state(),e.range=function(e,t){for(var r=[],n=e;t>=n;n++)r.push(n);return r},e.goToQuestion=function(){e.gameState.cast=e.gameState.cast.slice(0,e.gameState.numNames),window.location="/#/question"},e.noCastConfirm=function(){e.gameState.numNames=0,window.location="/#/question"};var n=function(){r.getClue(e.gameState.movie.id).then(function(t){e.gameState.clue=t},function(e){console.error("error getting clue: ",e)}),r.getCast(e.gameState.movie.id).then(function(t){console.log("getCast: ",t),e.gameState.cast=t.reverse()},function(e){console.error("error getting cast: ",e)})};n()}]),angular.module("app").controller("QuestionCtrl",["$scope","GameState","movieFactory",function(e,t){e.gameState=t.state(),e.submitGuess=function(){window.location="/#/answer"};var r=function(){};r()}]),angular.module("app").factory("GameState",function(){var e={category:{},movie:{},cast:[],clue:"",year:null,points:0,questions:0,numNames:null,categories:[],years:[],page:"selCategory",guess:"",win:!1},t={category:{},movie:{},cast:[],clue:"",year:null,numNames:null,categories:[],years:[],page:"selCategory",guess:"",win:!1};return{state:function(){return e},resetObj:function(){return t}}}),angular.module("app").factory("movieFactory",["$http","$q",function(e,t){var r={},n="https://api.themoviedb.org/3/",o="discover/movie",a="?api_key=4a3af8cc19e83189d99a0748e2663751",i="&with_genres=35&year=1993",s=n+o+a+i;return r.getClue=function(r){var i=t.defer();return o="movie/"+r,s=n+o+a,e.get(s).success(function(e){var t="";t=e.tagline.length?e.tagline:e.overview.substr(0,50),i.resolve(t)}).error(function(){i.reject("There was an error querying the tmdb API")}),i.promise},r.getCast=function(r){var i=t.defer();return o="movie/"+r+"/credits",s=n+o+a,e.get(s).success(function(e){i.resolve(e.cast.slice(0,10))}).error(function(){i.reject("There was an error querying the tmdb API")}),i.promise},r.getCategories=function(){var r=t.defer();return o="genre/movie/list",s=n+o+a,e.get(s).success(function(e){var t=MsUtils.shuffle(e.genres).slice(0,10);r.resolve(t)}).error(function(){r.reject("There was an error querying the tmdb API")}),r.promise},r.getMovie=function(r,l){var c=t.defer();return o="discover/movie",i="&with_genres="+r+"&year="+l,s=n+o+a+i,console.log("url: ",s),e.get(s).success(function(e){randMovie=MsUtils.shuffle(e.results.slice(0,1)),console.log("Name: ",randMovie[0].title),c.resolve(randMovie[0])}).error(function(){c.reject("There was an error querying the tmdb API")}),c.promise},r}]);