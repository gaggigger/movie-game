var MsConsts={};MsConsts._catBlacklist=["history","indie","road movie","erotic","history","sporting event","fan film","music","tv movie","disaster","short","eastern","foreign","documentary","sports film","crime","neo-noir","film noir","musical","sport"];var MsUtils={};MsUtils.shuffle=function(e){for(var t,r,n=e.length;0!==n;)r=Math.floor(Math.random()*n),n-=1,t=e[n],e[n]=e[r],e[r]=t;return e},MsUtils.range=function(e,t){for(var r=[],n=e;t>=n;n++)r.push(n);return r},function(e,t){"use strict";function r(){function e(e,r){return t.extend(new(t.extend(function(){},{prototype:e})),r)}function r(e,t){var r=t.caseInsensitiveMatch,n={originalPath:e,regexp:e},a=n.keys=[];return e=e.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?\*])?/g,function(e,t,r,n){var o="?"===n?n:null,i="*"===n?n:null;return a.push({name:r,optional:!!o}),t=t||"",""+(o?"":t)+"(?:"+(o?t:"")+(i&&"(.+?)"||"([^/]+)")+(o||"")+")"+(o||"")}).replace(/([\/$\*])/g,"\\$1"),n.regexp=new RegExp("^"+e+"$",r?"i":""),n}var n={};this.when=function(e,a){if(n[e]=t.extend({reloadOnSearch:!0},a,e&&r(e,a)),e){var o="/"==e[e.length-1]?e.substr(0,e.length-1):e+"/";n[o]=t.extend({redirectTo:e},r(o,a))}return this},this.otherwise=function(e){return this.when(null,e),this},this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function(r,a,o,i,s,l,c,u){function m(e,t){var r=t.keys,n={};if(!t.regexp)return null;var a=t.regexp.exec(e);if(!a)return null;for(var o=1,i=a.length;i>o;++o){var s=r[o-1],l="string"==typeof a[o]?decodeURIComponent(a[o]):a[o];s&&l&&(n[s.name]=l)}return n}function g(){var e=f(),n=h.current;e&&n&&e.$$route===n.$$route&&t.equals(e.pathParams,n.pathParams)&&!e.reloadOnSearch&&!v?(n.params=e.params,t.copy(n.params,o),r.$broadcast("$routeUpdate",n)):(e||n)&&(v=!1,r.$broadcast("$routeChangeStart",e,n),h.current=e,e&&e.redirectTo&&(t.isString(e.redirectTo)?a.path(p(e.redirectTo,e.params)).search(e.params).replace():a.url(e.redirectTo(e.pathParams,a.path(),a.search())).replace()),i.when(e).then(function(){if(e){var r,n,a=t.extend({},e.resolve);return t.forEach(a,function(e,r){a[r]=t.isString(e)?s.get(e):s.invoke(e)}),t.isDefined(r=e.template)?t.isFunction(r)&&(r=r(e.params)):t.isDefined(n=e.templateUrl)&&(t.isFunction(n)&&(n=n(e.params)),n=u.getTrustedResourceUrl(n),t.isDefined(n)&&(e.loadedTemplateUrl=n,r=l.get(n,{cache:c}).then(function(e){return e.data}))),t.isDefined(r)&&(a.$template=r),i.all(a)}}).then(function(a){e==h.current&&(e&&(e.locals=a,t.copy(e.params,o)),r.$broadcast("$routeChangeSuccess",e,n))},function(t){e==h.current&&r.$broadcast("$routeChangeError",e,n,t)}))}function f(){var r,o;return t.forEach(n,function(n){!o&&(r=m(a.path(),n))&&(o=e(n,{params:t.extend({},a.search(),r),pathParams:r}),o.$$route=n)}),o||n[null]&&e(n[null],{params:{},pathParams:{}})}function p(e,r){var n=[];return t.forEach((e||"").split(":"),function(e,t){if(0===t)n.push(e);else{var a=e.match(/(\w+)(.*)/),o=a[1];n.push(r[o]),n.push(a[2]||""),delete r[o]}}),n.join("")}var v=!1,h={routes:n,reload:function(){v=!0,r.$evalAsync(g)}};return r.$on("$locationChangeSuccess",g),h}]}function n(){this.$get=function(){return{}}}function a(e,r,n){return{restrict:"ECA",terminal:!0,priority:400,transclude:"element",link:function(a,o,i,s,l){function c(){f&&(f.remove(),f=null),m&&(m.$destroy(),m=null),g&&(n.leave(g,function(){f=null}),f=g,g=null)}function u(){var i=e.current&&e.current.locals,s=i&&i.$template;if(t.isDefined(s)){var u=a.$new(),f=e.current,h=l(u,function(e){n.enter(e,null,g||o,function(){!t.isDefined(p)||p&&!a.$eval(p)||r()}),c()});g=h,m=f.scope=u,m.$emit("$viewContentLoaded"),m.$eval(v)}else c()}var m,g,f,p=i.autoscroll,v=i.onload||"";a.$on("$routeChangeSuccess",u),u()}}}function o(e,t,r){return{restrict:"ECA",priority:-400,link:function(n,a){var o=r.current,i=o.locals;a.html(i.$template);var s=e(a.contents());if(o.controller){i.$scope=n;var l=t(o.controller,i);o.controllerAs&&(n[o.controllerAs]=l),a.data("$ngControllerController",l),a.children().data("$ngControllerController",l)}s(n)}}}var i=t.module("ngRoute",["ng"]).provider("$route",r);i.provider("$routeParams",n),i.directive("ngView",a),i.directive("ngView",o),a.$inject=["$route","$anchorScroll","$animate"],o.$inject=["$compile","$controller","$route"]}(window,window.angular),angular.module("app",["ngRoute"]),angular.module("app").config(["$routeProvider",function(e){e.when("/",{templateUrl:"templates/views/selCategory.html",controller:"CatCtrl"}).when("/selNames",{templateUrl:"templates/views/selNames.html",controller:"NameCtrl"}).when("/question",{templateUrl:"templates/views/question.html",controller:"QuestionCtrl"}).when("/answer",{templateUrl:"templates/views/answer.html",controller:"AnswerCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("app").controller("AnswerCtrl",["$scope","GameState","movieFactory",function(e){var t=function(){if(e.gameState.movie.title==e.gameState.guess){var t=e.gameState.totalNames-e.gameState.numNames+1;console.log("score: ",t),e.gameState.points+=t}e.gameState.questions++};t(),console.log("Answer gameState: ",e.gameState)}]),angular.module("app").controller("CatCtrl",["$scope","GameState","movieFactory",function(e,t,r){e.getMovie=function(){r.getMovie(e.gameState.category.id,e.gameState.year).then(function(t){e.gameState.movie=t,window.location="/movie-game/app/#/selNames"},function(e){console.error("error getting movie: ",e)})},e.getYears=function(){if(0===e.gameState.years.length){for(var t=(new Date).getFullYear(),r=[],n=1990;t>=n;n++)r.push(n);var a=MsUtils.shuffle(r).slice(0,5);e.gameState.years=a.sort()}};var n=function(){t.resetState(),r.getCategories().then(function(t){e.gameState.categories=t},function(e){console.error("error getting elements: ",e)})};n(),console.log("Category gameState: ",e.gameState)}]),angular.module("app").controller("MovieGameCtrl",["$scope","GameState","movieFactory",function(e,t){e.gameState=t.state()}]),angular.module("app").controller("NameCtrl",["$scope","GameState","movieFactory",function(e,t,r){e.castRange=[],e.goToQuestion=function(){e.gameState.totalNames=e.gameState.cast.length,e.gameState.cast=e.gameState.cast.slice(0,e.gameState.numNames),window.location="/movie-game/app/#/question"},e.noCastConfirm=function(){e.gameState.numNames=0,window.location="/movie-game/app/#/question"};var n=function(){r.getClue(e.gameState.movie.id).then(function(t){e.gameState.clue=t},function(e){console.error("error getting clue: ",e)}),r.getCast(e.gameState.movie.id).then(function(t){e.gameState.cast=t.reverse(),e.castRange=MsUtils.range(0,t.length)},function(e){console.error("error getting cast: ",e)})};n(),console.log("Name gameState: ",e.gameState)}]),angular.module("app").controller("QuestionCtrl",["$scope","GameState","movieFactory",function(e){e.submitGuess=function(){window.location="/movie-game/app/#/answer"};var t=function(){};t(),console.log("Question gameState: ",e.gameState)}]),angular.module("app").factory("GameState",function(){var e={category:{},movie:{},cast:[],totalNames:0,clue:"",year:null,points:0,questions:0,numNames:null,categories:[],years:[],page:"selCategory",guess:"",win:!1},t={category:{},movie:{},cast:[],totalNames:0,clue:"",year:null,numNames:null,categories:[],years:[],page:"selCategory",guess:"",win:!1};return{state:function(){return e},resetState:function(){for(var r in t)e[r]=t[r];return e}}}),angular.module("app").factory("movieFactory",["$http","$q",function(e,t){var r={},n="https://api.themoviedb.org/3/",a="discover/movie",o="?api_key=4a3af8cc19e83189d99a0748e2663751",i="&with_genres=35&year=1993",s=n+a+o+i;return r.getClue=function(r){var i=t.defer();return a="movie/"+r,s=n+a+o,e.get(s).success(function(e){var t="";t=e.tagline.length?e.tagline:e.overview.substr(0,50),i.resolve(t)}).error(function(){i.reject("There was an error querying the tmdb API")}),i.promise},r.getCast=function(r){var i=t.defer();return a="movie/"+r+"/credits",s=n+a+o,e.get(s).success(function(e){i.resolve(e.cast.slice(0,10))}).error(function(){i.reject("There was an error querying the tmdb API")}),i.promise},r.getCategories=function(){var r=t.defer(),i=[];return a="genre/movie/list",s=n+a+o,e.get(s).success(function(e){for(var t=0;t<e.genres.length;t++){var n=e.genres[t].name.toLowerCase();-1===MsConsts._catBlacklist.indexOf(n)&&i.push(e.genres[t])}var a=MsUtils.shuffle(i).slice(0,5);r.resolve(a)}).error(function(){r.reject("There was an error querying the tmdb API")}),r.promise},r.getMovie=function(r,l){var c=t.defer();return a="discover/movie",i="&with_genres="+r+"&year="+l+"&include_adult=false&vote_count.gte=5&certification_country=us&certification.lte=r",s=n+a+o+i,e.get(s).success(function(e){randMovie=MsUtils.shuffle(e.results.slice(0,1)),c.resolve(randMovie[0])}).error(function(){c.reject("There was an error querying the tmdb API")}),c.promise},r}]);